name: Preparar y Publicar en Producci칩n

on:
  push:
    branches:
      - main

jobs:
  prepare-for-production:
    runs-on: ubuntu-latest
    steps:
      - name: Chequear c칩digo fuente
        uses: actions/checkout@v2
      - name: Reemplazar URL y rutas de directorios
        run: |
          find . -type f ! -name "*.png" ! -name "*.jpg" -exec sed -i 's|https://customware.cl/reccius|https://reccius.cl/recciuscl|g' {} +
          find . -type f ! -name "*.png" ! -name "*.jpg" -exec sed -i 's|/home/customw2|/home/recciusc|g' {} +
      - name: Configurar usuario de Git
        run: |
          git config --global user.email "fabarca212@gmail.com"
          git config --global user.name "Hatt3rPi"
          
      - name: Check if secret is available
        env:
          MY_SECRET: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          if [ -z "$MY_SECRET" ]; then
            echo "Secret is NOT available."
            exit 1
          else
            echo "Secret is available."
          fi

      - name: Commit cambios
        run: |
          git add .
          git commit -m "Reemplazo autom치tico para producci칩n" || echo "No hay cambios para commit."

      - name: Push cambios al repositorio
        uses: appleboy/ssh-action@master
        with:
          host: github.com
          username: ${{ github.actor }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            git remote set-url origin git@github.com:${{ github.repository }}.git
            git push origin main
