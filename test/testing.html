<script>
    function calcularCantidadDePaginas() {
        const alturaMaximaPorPagina = 232; // Altura máxima permitida por página en pt
        const contenido = document.getElementById('content');

        // Calcula la altura del contenido en px
        const alturaContenidoPx = contenido.scrollHeight;

        // Convierte la altura del contenido a pt
        const alturaContenidoPt = alturaContenidoPx / 1.333;

        // Calcula la cantidad de páginas necesarias
        const cantidadDePaginas = Math.ceil(alturaContenidoPt / alturaMaximaPorPagina);

        return cantidadDePaginas;
    }
    function dividirContenidoEnPaginas() {
        let cantidadDePaginas = calcularCantidadDePaginas();
        let contenedorOriginal = document.getElementById('form-container');
        let contenidoPrincipal = document.getElementById('content');
        let contenidoAdicional = document.getElementById('additionalContent');

        let filasPrincipales = contenidoPrincipal.querySelectorAll('tr');
        let filasAdicionales = contenidoAdicional.querySelectorAll('tr');

        let indiceActualFilaPrincipal = 0;
        let indiceActualFilaAdicional = 0;

        for (let i = 1; i < cantidadDePaginas; i++) {
            let nuevaPagina = document.createElement('div');
            nuevaPagina.id = 'form-container-' + i;
            nuevaPagina.className = 'form-container';
            nuevaPagina.style.cssText = contenedorOriginal.style.cssText; // Copia estilos en línea

            // Clonar encabezado y pie de página con estilos en línea
            let headerClone = clonarConEstilos(contenedorOriginal.querySelector('.header-container'));
            let footerClone = clonarConEstilos(contenedorOriginal.querySelector('.footer'));

            nuevaPagina.appendChild(headerClone);

            // Crear nuevos contenedores de contenido para esta página
            let nuevoContenidoPrincipal = document.createElement('div');
            nuevoContenidoPrincipal.id = 'content-' + i;
            nuevoContenidoPrincipal.className = 'content';

            let nuevoContenidoAdicional = document.createElement('div');
            nuevoContenidoAdicional.id = 'additionalContent-' + i;
            nuevoContenidoAdicional.className = 'content';

            // Añadir filas a los nuevos contenedores de contenido hasta alcanzar la altura máxima
            let alturaPagina = 0;

            while (indiceActualFilaPrincipal < filasPrincipales.length && alturaPagina < alturaMaximaPorPagina) {
                let fila = filasPrincipales[indiceActualFilaPrincipal].cloneNode(true);
                nuevoContenidoPrincipal.appendChild(fila);
                alturaPagina += fila.clientHeight / 1.333;
                indiceActualFilaPrincipal++;
            }

            while (indiceActualFilaAdicional < filasAdicionales.length && alturaPagina < alturaMaximaPorPagina) {
                let fila = filasAdicionales[indiceActualFilaAdicional].cloneNode(true);
                nuevoContenidoAdicional.appendChild(fila);
                alturaPagina += fila.clientHeight / 1.333;
                indiceActualFilaAdicional++;
            }

            nuevaPagina.appendChild(nuevoContenidoPrincipal);
            nuevaPagina.appendChild(nuevoContenidoAdicional);
            nuevaPagina.appendChild(footerClone);

            document.body.appendChild(nuevaPagina);
        }
    }

    function clonarConEstilos(elemento) {
        let clon = elemento.cloneNode(true);
        clon.style.cssText = elemento.style.cssText; // Copia estilos en línea
        return clon;
    }
    function cargarDatosEspecificacion(id) {
        $.ajax({
            url: './backend/calidad/documento_especificacion_productoBE.php',
            type: 'GET',
            data: { id: id },
            success: function (response) {
                procesarDatosEspecificacion(response);

            },
            error: function (xhr, status, error) {
                console.error("Error en la solicitud: ", status, error);
            }
        });
    }

    function procesarDatosEspecificacion(response) {
        // Validación de la respuesta
        if (!response || !response.productos || !Array.isArray(response.productos)) {
            console.error('Los datos recibidos no son válidos:', response);
            return;
        }
        // Procesamiento de cada producto
        response.productos.forEach(function (producto) {
            poblarYDeshabilitarCamposProducto(producto);

            let especificaciones = Object.values(producto.especificaciones || {});
            if (especificaciones.length > 0) {
                let especificacion = especificaciones[0];

                let analisisFQ = especificacion.analisis.filter(a => a.tipo_analisis === 'analisis_FQ');
                if (analisisFQ.length > 0) {
                    mostrarAnalisisFQ(analisisFQ);
                }

                let analisisMB = especificacion.analisis.filter(a => a.tipo_analisis === 'analisis_MB');
                if (analisisMB.length > 0) {
                    mostrarAnalisisMB(analisisMB);
                }
            }
        });
        dividirContenidoEnPaginas();
    }


</script>